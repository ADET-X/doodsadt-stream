<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Pixeldrain Uploader</title>
</head>
<body>
  <h2>Upload Video ke Pixeldrain</h2>
  <input type="file" id="videoFile" accept="video/mp4"><br><br>
  <button onclick="upload()">Upload</button>
  <div id="status"></div>

  <script>
    async function upload() {
      const fileInput = document.getElementById("videoFile");
      const status = document.getElementById("status");
      const file = fileInput.files[0];

      if (!file) {
        status.innerText = "❗ Pilih file terlebih dahulu.";
        return;
      }

      status.innerText = "⏳ Uploading...";

      const formData = new FormData();
      formData.append("file", file);

      const apiKey = "d947be7b-4bf6-44d3-8d8a-36f41857bb4a";
      const authHeader = "Basic " + btoa(":" + apiKey);

      try {
        const res = await fetch("https://pixeldrain.com/api/file", {
          method: "POST",
          headers: {
            "Authorization": authHeader
          },
          body: formData
        });

        const text = await res.text();
        console.log("Server response:", text);

        if (!res.ok) {
          status.innerText = "❌ Gagal upload: " + text;
          return;
        }

        const data = JSON.parse(text);
        if (!data.success) {
          status.innerText = "❌ Upload gagal: " + (data.message || "Unknown error");
          return;
        }

        const fileId = data.id;
        const url = "https://pixeldrain.com/u/" + fileId;
        const direct = "https://pixeldrain.com/api/file/" + fileId + "?download";

        status.innerHTML = `
          ✅ Upload berhasil!<br>
          <video controls width="600">
            <source src="${direct}" type="video/mp4">
          </video><br>
          Link: <a href="${url}" target="_blank">${url}</a><br>
          <a href="player.html?id=${fileId}">▶ Tonton via player.html</a>
        `;
      } catch (err) {
        console.error(err);
        status.innerText = "❌ Terjadi kesalahan: " + err.message;
      }
    }
  </script>
</body>
</html>
